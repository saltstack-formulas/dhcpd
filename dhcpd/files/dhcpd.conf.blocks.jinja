{#- #### Class macro ############################################# #}
{%- macro print_classes(classes) %}
  {%- for config in classes %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
class "{{ config.name }}" {
  {{- statements.print(config) | indent(2) }}
    {%- if config.has_key('options') %}
  {{- options.print(config.options) | indent(2) }}
    {%- endif %}
}
  {% endfor %}
{%- endmacro %}
{#- #### Pool macro ############################################# #}
{%- macro print_pools(pools) %}
  {%- for config in pools %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
pool {
  {{- statements.print(config) | indent(2) }}
  {%- if config.has_key('failover_peer') %}
  failover peer "{{ config['failover_peer'] }}";
  {%- endif %}
}
  {% endfor %}
{%- endmacro %}
{# #### Groups macro ############################################ #}
{%- macro print_groups(groups) %}
  {%- for config in groups %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
group {{ config.name }} {
    {%- if config.has_key('options') %}
  {{- options.print(config.options) | indent(2) }}
    {%- endif %}
    {%- if config.has_key('hosts') %}
  {{- print_hosts(config.hosts) | indent(2) }}
    {%- endif %}
}
  {% endfor %}
{%- endmacro %}
{# #### Host macro ############################################## #}
{%- macro print_hosts(hosts) %}
  {%- for config in hosts %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
host {{ config.name }} {
  {{- statements.print(config) | indent(2) }}
    {%- if config.has_key('options') %}
  {{- options.print(config.options) | indent(2) }}
    {%- endif %}
}
  {% endfor %}
{%- endmacro %}
{#- #### Subnets macro ########################################### #}
{%- macro print_subnets(subnets) %}
  {%- for config in subnets %}
    {%- if config.has_key('comment') %}
      {%- for line in config['comment'].splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
subnet {{ config.name }} netmask {{ config.netmask }} {
  {{- statements.print(config) | indent(2) }}
    {%- if config.has_key('options') %}
  {{- options.print(config.options) | indent(2) }}
    {%- endif %}
    {%- if config.has_key('pools') %}
  {{- print_pools(config.pools) | indent(2) }}
    {%- endif %}
}
  {% endfor %}
{%- endmacro %}
{#- #### Shared networks ############################################# #}
{%- macro print_shared_networks(shared_networks) %}
  {%- for config in shared_networks %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
shared-network {{ config.name }} {
  {{- statements.print(config) | indent(2) }}
    {%- if config.has_key('options') %}
  {{- options.print(config.options) }}
    {%- endif %}
    {%- if config.has_key('subnets') %}
  {{- print_subnets(config.subnets) | indent(2) }}
    {%- endif %}
    {%- if config.has_key('pools') %}
  {{- print_pools(config.pools) | indent(2) }}
    {%- endif %}
}
  {% endfor %}
{%- endmacro %}
{#- #### Zone macro ############################################# #}
{%- macro print_zones(zones) %}
  {%- for config in zones %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
zone "{{ config.name }}" {
  primary {{ config.primary }};
  key {{ config.key }};
}
  {% endfor %}
{%- endmacro %}
{#- #### Key macro ############################################# #}
{%- macro print_keys(keys) %}
  {%- for config in keys %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
key "{{ config.name }}" {
  algorithm {{ config.algorithm }};
  secret "{{ config.secret }}";
}
  {% endfor %}
{%- endmacro %}
{#- #### Failover peer macro ################################### #}
{%- macro print_failover_peers(failover_peers) %}
  {%- for config in failover_peers %}
    {%- if config.has_key('comment') %}
      {%- for line in config.comment.splitlines() %}
# {{ line }}
      {%- endfor %}
    {%- endif %}
failover peer "{{ config.name }}" {
    {%- if config.has_key('role') and config.role == 'primary' %}
  primary;
      {%- if config.has_key('mclt') %}
  mclt {{ config.mclt }};
      {%- endif %}
      {%- if config.has_key('split') %}
  split {{ config.split }};
      {%- elif config.has_key('hba') %}
  hba {{ config.hba }};
      {%- endif %}
    {%- else %}
  secondary;
    {%- endif %}
    {%- if config.has_key('address') %}
  address {{ config.address }};
    {%- endif %}
    {%- if config.has_key('port') %}
  port {{ config.port }};
    {%- endif %}
    {%- if config.has_key('peer_address') %}
  peer address {{ config.peer_address }};
    {%- endif %}
    {%- if config.has_key('peer_port') %}
  peer port {{ config.port }};
    {%- endif %}
    {%- if config.has_key('max_response_delay') %}
  max-response-delay {{ config.max_response_delay }};
    {%- endif %}
    {%- if config.has_key('max_unacked_updates') %}
  max-unacked-updates {{ config.max_unacked_updates }};
    {%- endif %}
    {%- if config.has_key('load_balance_max_seconds') %}
  load balance max seconds {{ config.load_balance_max_seconds }};
    {%- endif %}
    {%- if config.has_key('max_lease_misbalance') %}
  max-lease-misbalance {{ config.max_lease_misbalance }};
    {%- endif %}
    {%- if config.has_key('max_lease_ownership') %}
  max-lease-ownership {{ config.max_lease_ownership }};
    {%- endif %}
    {%- if config.has_key('min_balance') %}
  min-balance {{ config.min_balance }};
    {%- endif %}
    {%- if config.has_key('max-balance') %}
  max-balance {{ config.max_balance }};
    {%- endif %}
}
  {%- endfor %}
{%- endmacro %}
